<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <title>Babylon.js sample code</title>

        <!-- Babylon.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/ammo.js"></script>
        <script src="https://preview.babylonjs.com/cannon.js"></script>
        <script src="https://preview.babylonjs.com/Oimo.js"></script>
        <script src="https://preview.babylonjs.com/earcut.min.js"></script>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
        <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }
        </style>
    </head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        var canvas = document.getElementById("renderCanvas");

        var engine = null;
        var scene = null;
        var sceneToRender = null;
        var createDefaultEngine = function() { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true,  disableWebGL2Support: false}); };
        var createScene = function () {
    // This creates a basic Babylon Scene object (non-mesh)
    var scene = new BABYLON.Scene(engine);

//     var camera = new BABYLON.FreeCamera("camera1", new BABYLON.Vector3(0, 5, -10), scene);

// // This targets the camera to scene origin
// camera.setTarget(BABYLON.Vector3.Zero());

// // This attaches the camera to the canvas
// camera.attachControl(canvas, true);

    // var camera = new BABYLON.FollowCamera("FollowCam", new BABYLON.Vector3(0, 5, -5), scene);
    //     	camera.attachControl(canvas, true);

          
    //     	//The goal distance of camera from target
	// 		camera.radius = 1;
			
	// 		// The goal height of camera above local origin (centre) of target
	// 		camera.heightOffset = 0;
			
	// 		// The goal rotation of camera around local origin (centre) of target in x y plane
	// 		camera.rotationOffset = 0;
			
	// 		//Acceleration of camera in moving from current to goal position
	// 		camera.cameraAcceleration = 0
			
	// 		//The speed at which acceleration is halted 
	// 		camera.maxCameraSpeed = 10

//     var camera = new BABYLON.ArcRotateCamera("Camera", 0, 0, 0, new BABYLON.Vector3(0,-3,7), scene);
//             camera.setPosition(new BABYLON.Vector3(0, 0, 0));
//             // camera.setPosition(new BABYLON.Vector3(-0.3, 5, -2.2));
//             camera.attachControl(canvas, true);
// // camera.lowerRadiusLimit = camera.upperRadiusLimit = camera.radius = 8;
// camera.lowerRadiusLimit = 4;
// camera.upperRadiusLimit = 8;

var camera = new BABYLON.UniversalCamera("MyCamera", new BABYLON.Vector3(0, 0, 0), scene);
    camera.minZ = 0.0001;
    camera.attachControl(canvas, true);
    camera.speed = 0.1;
    camera.angularSpeed = 0.05;
    camera.angle = Math.PI/2;
    camera.direction = new BABYLON.Vector3(Math.cos(camera.angle), 0, Math.sin(camera.angle));
    
    //Add viewCamera that gives first person shooter view
    var viewCamera = new BABYLON.UniversalCamera("viewCamera", new BABYLON.Vector3(0, 0, -3), scene);
    viewCamera.parent = camera;
    // viewCamera.setTarget(new BABYLON.Vector3(0, -0.0001, 1));
    
    //Activate both cameras
    scene.activeCameras.push(viewCamera);
    scene.activeCameras.push(camera);

    //Add two viewports
    camera.viewport = new BABYLON.Viewport(0, 0.5, 1.0, 0.5);
    viewCamera.viewport = new BABYLON.Viewport(0, 0, 1.0, 0.5); 

camera.checkCollisions = true;
    camera.applyGravity = true;
    // camera.viewport = new BABYLON.Viewport(0, 0.5, 1.0, 0.5);
        	// Lights
        	var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(0, 1, 0), scene);
        	light.intensity = 0.6;
        	light.specular = BABYLON.Color3.Black();
        
        	

    // This creates a light, aiming 0,1,0 - to the sky (non-mesh)
    var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);

    // Default intensity is 1. Let's dim the light a small amount
    light.intensity = 0.7;

    

    BABYLON.SceneLoader.ImportMeshAsync("", "", "Xbot.glb").then((result) => {
var bot =  result.meshes[0]; 
// camera.lockedTarget = bot;
// bot.addRotation(0,0,0)
bot.parent = camera;
    // bot.rotation.x = Math.PI/2;
//  bot.position.y = -2;
bot.checkCollisions = true;
var walkAnim = scene.animationGroups.find(a => a.name === 'walk');
        		var walkParam = { name: "Walk", anim: walkAnim, weight: 0 };
        		walkAnim.play(true);
        		walkAnim.setWeightForAllAnimatables(0);
				
				document.onkeydown = checkKey;

				function checkKey(e) {

					e = e || window.event;

					if (e.keyCode == '38') {
						// up arrow
                        // bot.position.z += 0.05;
						walkAnim.setWeightForAllAnimatables(1);
						
					}
					else if (e.keyCode == '40') {
						// down arrow
                        // bot.position.z -= 0.05;
					}
					else if (e.keyCode == '37') {
					// left arrow
					}
					else if (e.keyCode == '39') {
					// right arrow
					}

				}
				document.onkeyup = checkKeyy;

				function checkKeyy(ev) {

					ev = ev || window.event;

					if (ev.keyCode == '38') {
						// up arrow
						walkAnim.setWeightForAllAnimatables(0);
					}
					else if (ev.keyCode == '40') {
						// down arrow
					}
					else if (ev.keyCode == '37') {
					// left arrow
					}
					else if (ev.keyCode == '39') {
					// right arrow
					}

				}
});


// var box = new BABYLON.MeshBuilder.CreateBox("crate", {size: 2}, scene);
//     box.material = new BABYLON.StandardMaterial("Mat", scene);
//     box.material.diffuseTexture = new BABYLON.Texture("textures/crate.png", scene);
//     box.checkCollisions = true;
//     box.position = new BABYLON.Vector3(0, 1, 5 );

    // Our built-in 'ground' shape.
    				//ground
	const ground = BABYLON.MeshBuilder.CreateGround("ground", {height: 50, width: 50, subdivisions: 4});
	const groundMat = new BABYLON.StandardMaterial("groundMat");
	groundMat.diffuseTexture = new BABYLON.Texture("textures/grass.jpg", scene);
	groundMat.diffuseTexture.uScale = 30;
    groundMat.diffuseTexture.vScale = 30;
    ground.checkCollisions = true;
    
	ground.material = groundMat; //Place the material property of the ground
    ground.material.backFaceCulling = false;

    var lowerGround = ground.clone("lowerGround");
    lowerGround.scaling.x = 50;
    lowerGround.scaling.z = 50;
    lowerGround.position.y = -16;
    lowerGround.material = ground.material.clone("lowerMat");
    lowerGround.material.diffuseColor = new BABYLON.Color3(0, 1, 0);

    // Skybox
	// var skybox = BABYLON.MeshBuilder.CreateBox("skyBox", {size:1000.0}, scene);
	// var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
	// skyboxMaterial.backFaceCulling = false;
	// skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("textures/skybox", scene);
	// skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
	// skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
	// skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
	// skybox.material = skyboxMaterial;
    scene.gravity = new BABYLON.Vector3(0, -0.9, 0);
    scene.collisionsEnabled = true;
    return scene;
};
                window.initFunction = async function() {               
                    var asyncEngineCreation = async function() {
                        try {
                        return createDefaultEngine();
                        } catch(e) {
                        console.log("the available createEngine function failed. Creating the default engine instead");
                        return createDefaultEngine();
                        }
                    }

                    window.engine = await asyncEngineCreation();
        if (!engine) throw 'engine should not be null.';
        window.scene = createScene();};
        initFunction().then(() => {sceneToRender = scene        
            engine.runRenderLoop(function () {
                if (sceneToRender && sceneToRender.activeCamera) {
                    sceneToRender.render();
                }
            });
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>
</html>
